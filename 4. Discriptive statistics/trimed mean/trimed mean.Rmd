---
title: "Средние и медиана"
author: "G. Moroz"
date: '14 марта 2016 г '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

## Введение

Обычно, когда говорят о среднем арифметическом, то его ругают из-за чувсвительности к выбросам. Возьмем для примера среднюю зарплату сотрудников некоторого университета: 50 преподавателей получает 5 т. р., 20 сотрудников администрации 10 т. р., а ректор и два праректора получают по 200 т. р. Ректор, который так успешно обставил свои дела может в отчетах и интервью смело заявлять, что **средняя зарплата в университете 14 т. р.**, а преподавателям лишь остается возмущенно писать в социальных сетях, что **медиана и мода равны 5**, так как 92% сотрудников получают зарплату ниже средней.
```{r, echo=FALSE}
salary <- data.frame(должность = c("преподаватели (50 чел.)", "администрация  (20 чел.)", "ректорат  (3 чел.)"), зарплата = c(5, 10, 200))
mu <- mean(c(rep(5, 50), rep(10, 20), rep(200, 3)))
ggplot(salary, aes(x = должность, y = зарплата, fill = должность)) +
  geom_bar(colour="black", stat="identity") +
  guides(fill=FALSE)+
  scale_y_sqrt(breaks = sort(c(seq(min(salary$зарплата), max(salary$зарплата), length.out=4), round(mu, 1))))+
  theme_bw()+
  geom_hline(yintercept = mu, linetype = 2)+
  geom_text(aes(0.65,mu,label = "средняя", vjust = -1))
```

Проблема того, что средняя и медиана могут значительно различаться кажется достаточно надуманной --- все зависит от распределения, и никто не обещал, что такая вещь как распределение зарплат будет симметричным. Однако среднее арифметическое нам ничего про распределение не говорит. Допустим, мы хотим "пощупать" ректора, как это сделать? Во-первых, понятно, что одной медианы тоже недостаточно, так как одинаковая медиана может быть у распределений, которые могут иметь разный размах: от 4 до 6 и от 5 до 200. Давайте заведем себе симметричное распределение, с которым и будем сравнивать разные предложения.
```{r, echo=FALSE}
set.seed(14032016)
fake <- table(cut(rnorm(100, 10, sd = 4), breaks = c(5, 8.3, 12.6, 15)))
fake <- data.frame(groups = c("group1", "group2", "group3"), fake = c(fake[1], fake[2], fake[3]))
mu2 <- mean(fake$fake)
ggplot(fake, aes(x = groups, y = fake, fill = groups)) +
  geom_bar(colour="black", stat="identity") +
  guides(fill=FALSE)+
  scale_y_continuous(breaks = sort(c(seq(min(fake$fake), max(fake$fake), length.out=2), round(mu2, 1))))+
  theme_bw()+
  geom_hline(yintercept = mu2, linetype = 2)+
  geom_text(aes(3.35,mu2,label = "средняя", vjust = -1))
```
```{r, echo = F}
for (i in seq(0,1, by = 0.01)) {
  a[b] <- mean(t,trim = i)
  b<-b+1
}

b <- 1

a <- NA

hist(t)
t = c(rnorm(100), rnorm(50, mean = 1))

df <- data.frame(trim = seq(0,1, by = 0.01), mean = a)
ggplot(df, aes(x = trim, y = mean))+
  geom_point()+
  geom_hline(yintercept = median(t), linetype = 2)
```
